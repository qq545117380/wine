function Gocartplus(t,e,a,c){document.domain="gjw.com";var o=getCookie("ShoppingCart");getVastr(t,e,function(r){var n=r;$.ajax({type:"POST",url:httpcook,data:{user_id:n.Message,ProductID:t,Quantity:e,Increase:a,code:o,vastr:n.Data},async:!1,datatype:"jsonp",success:function(t){0==t.Success?($(".itemNum").html(t.Data),$(".fixnavbox a em").html(t.Data),""!=t.Message&&t.Message.match(/.cart/)&&setCookie("ShoppingCart",t.Message.replace(/\\/g,"/")),c(t)):c(t)}})})}function goCart(t,e){Gocartplus(t,1,!0,function(t){window.location.reload()})}function getVastr(t,e,a){layer.open({type:2,skin:"ksy",shade:0,area:["0","0"],content:"http://order.gjw.com/login/Login_Actiont?Ac=Vastr",time:3e3,success:function(t,e){var c=layer.getChildFrame("body",e),o=(window[t.find("iframe")[0].name],JSON.parse(c.html()));a(o)}})}function getCookie(t){var e,a=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(a))?unescape(e[2]):null}function setCookie(t,e){var a=30,c=new Date;c.setTime(c.getTime()+24*a*60*60*1e3),document.domain="gjw.com",document.cookie=t+"="+escape(e)+";expires="+c.toGMTString()+";Domain=.gjw.com;path=/"}function CartCountFn(){getVastr("",0,function(t){var e=t,a=getCookie("ShoppingCart");$.ajax({type:"POST",url:CartCountCook,async:!1,datatype:"JSON",data:{user_id:e.Message,shopping_cart:a,vastr:e.Data},success:function(t){"0"==t.Success&&($(".fixnavbox a em").html(t.Data),$(".itemNum").html(t.Data),$("#head_cart_no").html(t.Data))}})})}function calculationCount(t,e){if(e)var a=moneyFormat($("#palyMoney").text().substring(1))-t;else var a=parseFloat(moneyFormat($("#palyMoney").text().substring(1)))+parseFloat(t);"0"==a||parseFloat(a)<0?(a=0,$("#ASettlement1").attr("href","javascript: layer.msg('您的购物车内还没有要结算的商品，请选中购买！');"),$("#ASettlement").attr("href","javascript: layer.msg('您的购物车内还没有要结算的商品，请选中购买！');")):($("#ASettlement").attr("href","http://order.gjw.com/order/Settlement"),$("#ASettlement1").attr("href","http://order.gjw.com/order/Settlement")),$("#palyMoney").text("¥"+fmoney(a.toFixed(2),2))}function delCount(t){$("#tbcart"+t).fadeOut();var e=$("#sum"+t+" b").html(),a=moneyFormat(e.substring(1));$("#tbcart"+t+"  td input").is(":checked")||(a=0),calculationCount(a,!0),$("#tbcart"+t).remove()}function moneyFormat(t){return parseFloat(t.replace(/[^\d\.-]/g,""))}function fmoney(e,a){a=a>0&&a<=20?a:2,e=parseFloat((e+"").replace(/[^\d\.-]/g,"")).toFixed(a)+"";var c=e.split(".")[0].split("").reverse(),o=e.split(".")[1];for(t="",i=0;i<c.length;i++)t+=c[i]+((i+1)%3==0&&i+1!=c.length?",":"");return t.split("").reverse().join("")+"."+o}function Check(t,e){$.ajax({type:"POST",url:IscheckedPay,async:!1,datatype:"JSON",data:{shopping_cart:code,proID:e,state:t},success:function(t){console.log(t),"0"==t.Success}})}function ch(t,e){new Date;if("checked"==t.attr("checked")){$("#palyMoney").text("¥0"),$(".tbcart td input").each(function(){$(this).attr("checked","checked")}),$("#CheckAll").attr("checked","checked"),$("#check_All").attr("checked","checked");var a=0;$(".cs_sum b").each(function(){var t=moneyFormat($(this).html());a=parseFloat(t)+parseFloat(a)}),calculationCount(a,!1),Check(1,0)}else{$(".tbcart td input").each(function(){$(this).attr("checked",!1)}),$("#CheckAll").attr("checked",!1),$("#check_All").attr("checked",!1);var a=0;$(".cs_sum b").each(function(){var t=moneyFormat($(this).html());a=parseFloat(t)+parseFloat(a)}),calculationCount(a,!0),Check(2,0)}}function d(){var t=0,e=0;$(".tbcart td input").each(function(){t++,$(this).is(":checked")&&e++}),parseFloat(t)==2*parseFloat(e)&&($("#CheckAll").attr("checked","checked"),$("#check_All").attr("checked","checked"))}function Collect(t){$.ajax({type:"POST",url:CollectStr,data:{ID:t},async:!1,datatype:"jsonp",success:function(t){layer.msg(t.Message)}})}function Exit(){layer.open({type:2,skin:"ksy",shade:0,area:["0","0"],content:"http://order.gjw.com/login/Login_Actiont?Ac=exit",time:3e3,success:function(t,e){var a=layer.getChildFrame("body",e),c=(window[t.find("iframe")[0].name],JSON.parse(a.html()));0==c.Success&&(location.href=location.href)}})}function Remove(t){$.ajax({type:"POST",url:apireMove,data:{shopping_cart:code,proID:t},async:!1,datatype:"JSONP",success:function(e){0==e.Success&&delCount(t)}})}function Clear(){$.ajax({type:"POST",url:clear,data:{shopping_cart:code},async:!1,datatype:"JSON",success:function(t){window.location.reload()}})}function delCheck(){$.ajax({type:"POST",url:RemoveCheck,data:{shopping_cart:code},async:!1,datatype:"JSON",success:function(t){$(".tbcart td input").each(function(){if($(this).is(":checked")){var t=$(this).val();delCount(t)}})}})}var httpcook="http://order.gjw.com/Order_Api/addToCart",vastr="http://www.gjw.com//Gj_Api/vastr",code=getCookie("ShoppingCart");$(function(){var t=!0;$(".Cart_up").click(function(e){if(console.log(99),t){t=!1;var a=$(this).attr("index"),c=$(this).parent().parent().find(".Quantity").val(),o=c,r=!1;c=parseInt(c)+1,$("#Checkbox"+a).is(":checked")||($("#Checkbox"+a).attr("checked",!0),r=!0),c?c>0?Gocartplus(a,c,!1,function(e){if(t=!0,0==e.Success&&""==e.Message){$("#Quantity"+a).val(c);var n=moneyFormat($("#sum"+a+" b").html().substring(1)),i=parseFloat(n/o).toFixed(2),s=parseFloat(i*c).toFixed(2);$("#sum"+a+" b").html("¥"+fmoney(s,2)),r&&(i=s),calculationCount(i,!1);var l=moneyFormat($("#Pro"+a).html());if(!isNaN(l)){var u=parseFloat(l/o).toFixed(2);$("#Pro"+a).html("立减 "+u*c+" 元")}$(".fixnavbox a em").html(e.Data),$(".itemNum").html(e.Data),$("#head_cart_no").html(e.Data)}else t=!0,layer.msg(e.Message)}):(t=!0,layer.msg("购买的商品数量不能小于1件!")):(t=!0,layer.msg("数据不能为空"))}}),$(".Quantity").blur(function(t){var e=$(this).attr("index"),a=$(this).val(),c=!0;if(isNaN(moneyFormat(a))&&moneyFormat(a)<0)return void layer.msg("客官，请输入有效的数字！");if(0==a&&(a=1),c){if(c=!1,a<=0)return layer.msg("客官，商品数量不能小于1哟！"),!1;Gocartplus(e,a,!1,function(t){c=!0,0==t.Success&&""==t.Message?window.location.reload():layer.msg(t.Message),window.location.reload()})}});var e=!0;$(".Cart_down").click(function(t){if(e){e=!1;var a=$(this).attr("index"),c=$(this).parent().parent().find(".Quantity").val(),o=c;c=parseInt(c)-1;var r=!1;$("#Checkbox"+a).is(":checked")||($("#Checkbox"+a).attr("checked",!0),r=!0),c?c>0?($(this).parent().parent().find(".Quantity").val(c),Gocartplus(a,c,!1,function(t){if(e=!0,0==t.Success){var n=moneyFormat($("#sum"+a+" b").html().substring(1)),i=parseFloat(n/o).toFixed(2),s=parseFloat(i*c).toFixed(2);r?(i=s,calculationCount(i,!1)):calculationCount(i,!0),$("#sum"+a+" b").html("¥"+fmoney(s,2));var l=moneyFormat($("#Pro"+a).html());if(!isNaN(l)){var u=parseFloat(l/o).toFixed(2);$("#Pro"+a).html("立减 "+u*c+" 元")}$(".fixnavbox a em").html(t.Data),$(".itemNum").html(t.Data),$("#head_cart_no").html(t.Data)}})):(e=!0,layer.msg("购买的商品数量不能小于1件!")):(e=!0,layer.msg("数据不能为空"))}}),$("#CheckAll").click(function(){ch($(this),0)}),$("#check_All").click(function(){ch($(this),0)}),$(".check_cb").click(function(){var t=(new Date,$(this).val()),e=$("#sum"+t+" b").html(),a=moneyFormat(e.substring(1));"checked"==$(this).attr("checked")?(Check(1,t),d(),calculationCount(a,!1)):(Check(2,t),calculationCount(a,!0),$("#CheckAll").attr("checked",!1),$("#check_All").attr("checked",!1))}),$("#creaPro").click(function(){Clear()}),$("#delePro").click(function(){delCheck()})});var CartCountCook="http://order.gjw.com/Order_Api/CartCount";CartCountFn(),$(".shopping_poppup_onoff").click(function(){$("#shopping_poppup").hide()});var IscheckedPay="http://order.gjw.com/Order_Api/CheckPro",CollectStr="http://order.gjw.com/Order_Api/collectPro",apireMove="http://order.gjw.com/Order_Api/RemoveProID",clear="http://order.gjw.com/Order_Api/ClearCart",RemoveCheck="http://order.gjw.com/Order_Api/RemoveCheck";